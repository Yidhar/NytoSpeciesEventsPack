namespace = gfnytoaction
#坍缩液轨道抛射
planet_event = {
	id = gfnytoaction.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {		
		has_orbital_bombardment_stance = gfnyto_collapse_liquid
		from = {
			OR = {
				is_country_type = default
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
			}
		}
		habitable_planet = yes
	}	
	immediate = {
		set_update_modifiers_batch = begin
		if = {
			limit = { 
				planet_devastation >= 95
			}
			owner = {
				add_static_war_exhaustion = {
					attacker = from
					location = root
					value_for_planet_destruction = 0.5
				}
				country_event = { id = gfnytoaction.2 }
			}
			from = { country_event = { id = gfnytoaction.3 } }
			change_pc = pc_GF_nyto_embers_gloomy
			remove_all_buildings = yes
			reroll_deposits = yes
			remove_modifier = "natural_beauty"
			remove_modifier = "atmospheric_aphrodisiac"
			remove_modifier = "atmospheric_hallucinogen"
			remove_modifier = "lush_planet"
			remove_modifier = "dangerous_wildlife"
			set_planet_flag = gfnyto_collapse_liquid_nuked
			set_planet_flag = armageddon_nuked
			every_owned_pop={kill_pop=yes}

		}
		set_update_modifiers_batch = end
	}
}
country_event = {
	id = gfnytoaction.2
	title = "action.82.name"
	picture = GFX_evt_nuclear_explosion
	desc = action.82.desc
	show_sound = event_super_explosion
	location = from
	is_triggered_only = yes
	option = {
		name = action.82.a
		custom_tooltip = bombed_to_tomb_world
		if = {
			limit = { NOT = { has_ethic = ethic_gestalt_consciousness } }
			add_modifier = {
				modifier = colossus_victim
				days = 10800 # 30 years
			}
		}
	}
}
country_event = {
	id = gfnytoaction.3
	title = "action.82.name"
	picture = GFX_evt_nuclear_explosion
	desc = gfnytoaction.4.desc
	show_sound = event_super_explosion
	location = from
	is_triggered_only = yes
	option = {
		name = EXCELLENT
		custom_tooltip = bombed_to_tomb_world
		hidden_effect ={
			if = {
				limit = {
					or = {
						has_ascension_perk = ap_become_the_crisis
						has_ascension_perk = ap_GF_nyto_conquer_hell
					}
				}
				add_resource ={ 
					menace = 350
				}
			}
		}
	}
}
#行星轨道防御系统
#被轰炸
planet_event = {
	id = gfnytoaction.10
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		colony_type = col_GF_nyto_capital
	}
	immediate = {
		if = {
			limit ={
				check_modifier_value = {
					modifier = planet_orbital_bombardment_damage
					value > 1000
				}
			}
			set_update_modifiers_batch = begin
			every_owned_pop = {
				kill_pop = yes
			}
			destroy_colony = yes
			set_update_modifiers_batch = end
		}
	}
}

country_event = {
	id = gfnytoaction.6
	title = "gfnytoaction.6.name"
	desc = "gfnytoaction.6.desc"
	fire_only_once = yes
	picture = GFX_evt_GFnyto_defense_eild_attack_project_complete
	show_sound = event_space_battle
	location = from
	is_triggered_only = yes
	option = {name = UNDERSTOOD}
}

#更新堡垒强度
ship_event = {
	id = gfnytoaction.2001
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		if = {
			limit = {
				not = {
					check_variable = {
						which = GF_nyto_stions_fortes_has_hp
						value = owner.modifier:GF_nyto_stions_HP_nums
					}
					is_in_combat = no
				}
			}
			set_variable = {
				which = GF_nyto_stions_fortes_has_hp
				value = owner.modifier:GF_nyto_stions_HP_nums
			}
		}  #重置非战斗状态要塞的血条上限
		#触发要塞更新触发器
		fire_on_action = {
			on_action = on_GF_nyto_stions_update
			scopes = {
				from = this
			}
		}
		owner ={
			export_modifier_to_variable = {
				modifier = GF_nyto_stions_HP_nums
				variable = test
			}
		}

		ship_event = {
			id = gfnytoaction.2001
			days = 1
		}
	}
}

ship_event = {
	id = gfnytoaction.2002
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_in_combat = yes
	}
	immediate = {
		#处于战斗状态的结算+1
		change_variable = {
			which = GF_nyto_stions_fortes_has_hp
			value = 1
		}
		repair_ship = yes
	}
}

country_event = {
	id = gfnytoaction.2003
	title = "x"
	hide_window = no
	is_triggered_only = yes
	diplomatic = yes
	custom_gui = boss_hp_test
	auto_opens = yes
	major = yes
	diplomatic_title = "GF_nyto_boss_name"
	immediate = {
		random_owned_ship = {
			limit = {
				is_ship_size = GFnyto_stions_fortress
			}
			save_global_event_target_as = is_GF_nyto_Boss
			change_variable = {
				which = GF_nyto_is_boss_hp_mult
				value = 100
			}
			set_disable_at_health = 0.1
		}
	}
	abort_trigger = {
		not = {
			exists = event_target:is_GF_nyto_Boss
		}
	}
	after = {
		if = {
			limit = {
				exists = event_target:is_GF_nyto_Boss
			}
		}
	}
}
